!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i(t.ImageProcess=t.ImageProcess||{})}(this,function(t){"use strict";function i(t,i,e){var a,s,n,r,o,h,c,l,p,d,u=t.data,g=t.width,f=t.height,m=[],v=0;for(i=Math.floor(i)||3,e=e||i/3,h=1/(Math.sqrt(2*Math.PI)*e),o=-1/(2*e*e),c=0,a=-i;i>=a;a++,c++)r=h*Math.exp(o*a*a),m[c]=r,v+=r;for(c=0,d=m.length;d>c;c++)m[c]/=v;for(s=0;f>s;s++)for(a=0;g>a;a++){for(n=r=o=h=0,v=0,l=-i;i>=l;l++)p=a+l,p>=0&&g>p&&(c=4*(s*g+p),n+=u[c]*m[l+i],r+=u[c+1]*m[l+i],o+=u[c+2]*m[l+i],v+=m[l+i]);c=4*(s*g+a),u[c]=n/v,u[c+1]=r/v,u[c+2]=o/v}for(a=0;g>a;a++)for(s=0;f>s;s++){for(n=r=o=h=0,v=0,l=-i;i>=l;l++)p=s+l,p>=0&&f>p&&(c=4*(p*g+a),n+=u[c]*m[l+i],r+=u[c+1]*m[l+i],o+=u[c+2]*m[l+i],v+=m[l+i]);c=4*(s*g+a),u[c]=n/v,u[c+1]=r/v,u[c+2]=o/v}return t}function e(t,i,e){for(var a=t.data,s=i/50,n=(e||0)/50,r=Math.tan((45+44*n)*Math.PI/180),o=0,h=a.length;h>o;o+=4)for(var c=0;3>c;c++)a[o+c]=(a[o+c]-127.5*(1-s))*r+127.5*(1+s);return t}function a(t,i,e,a,s,n,r,o){for(var e,a,s,n,r,o,h=[],c=0;c<arguments.length;c++)if(c)switch(typeof arguments[c]){case"string":/\d+%/.test(arguments[c])?a=arguments[c].replace("%",""):/[RGB]+/.test(arguments[c])?o=arguments[c]:e=arguments[c];break;case"number":h.push(arguments[c]);break;case"boolean":r=arguments[c]}var l=t.data,p=i.data;s=h[0]||0,n=h[1]||0,a=a/100||1,r=r||!1,o=o||"RGB",/[RGB]+/.test(o)||(o="RGB");for(var d,u,g,f,m,v,w,x,b=o.replace("R","0").replace("G","1").replace("B","2"),C=1,B=t.width,y=(t.height,p.length),D=i.width,I=[b.indexOf("0")>-1,b.indexOf("1")>-1,b.indexOf("2")>-1],M=4*C,c=0,$=l.length;$>c;c+=M)if(u=c/4,g=parseInt(u/B),f=u%B,m=g-n,v=f-s,w=m*D+v,x=4*w,x>=0&&y-4>x&&D>v&&v>=0)for(var k=0;3>k&&0!=p[x+3];k++)switch(l[c+3]=p[x+3],e){case"颜色减淡":I[k]&&(d=l[c+k]+l[c+k]*p[x+k]/(255-p[x+k]),l[c+k]=(1-a)*l[c+k]+a*d);break;case"变暗":I[k]&&(d=l[c+k]<p[x+k]?l[c+k]:p[x+k],l[c+k]=(1-a)*l[c+k]+a*d);break;case"变亮":I[k]&&(d=l[c+k]>p[x+k]?l[c+k]:p[x+k],l[c+k]=(1-a)*l[c+k]+a*d);break;case"正片叠底":I[k]&&(d=parseInt(l[c+k]*p[x+k]/255),l[c+k]=(1-a)*l[c+k]+a*d);break;case"滤色":I[k]&&(d=parseInt(255-(255-l[c+k])*(255-p[x+k])/255),l[c+k]=(1-a)*l[c+k]+a*d);break;case"叠加":I[k]&&(d=l[c+k]<=127.5?l[c+k]*p[x+k]/127.5:255-(255-l[c+k])*(255-p[x+k])/127.5,l[c+k]=(1-a)*l[c+k]+a*d);break;case"强光":I[k]&&(d=p[x+k]<=127.5?l[c+k]*p[x+k]/127.5:l[c+k]+(255-l[c+k])*(p[x+k]-127.5)/127.5,l[c+k]=(1-a)*l[c+k]+a*d);break;case"差值":I[k]&&(d=l[c+k]>p[x+k]?l[c+k]-p[x+k]:p[x+k]-l[c+k],l[c+k]=(1-a)*l[c+k]+a*d);break;case"排除":I[k]&&(d=l[c+k]+p[x+k]-l[c+k]*p[x+k]/127.5,l[c+k]=(1-a)*l[c+k]+a*d);break;case"点光":I[k]&&(d=l[c+k]<2*p[x+k]-255?2*p[x+k]-255:l[c+k]<2*p[x+k]?l[c+k]:2*p[x+k],l[c+k]=(1-a)*l[c+k]+a*d);break;case"颜色加深":I[k]&&(d=255-255*(255-l[c+k])/p[x+k],l[c+k]=(1-a)*l[c+k]+a*d);break;case"线性加深":if(I[k]){var L=l[c+k]+p[x+k];d=L>255?L-255:0,l[c+k]=(1-a)*l[c+k]+a*d}break;case"线性减淡":if(I[k]){var L=l[c+k]+p[x+k];d=L>255?255:L,l[c+k]=(1-a)*l[c+k]+a*d}break;case"柔光":I[k]&&(d=p[x+k]<127.5?((2*p[x+k]-255)*(255-l[c+k])/65025+1)*l[c+k]:(2*p[x+k]-255)*(Math.sqrt(l[c+k]/255)-l[c+k]/255)+l[c+k],l[c+k]=(1-a)*l[c+k]+a*d);break;case"亮光":I[k]&&(d=p[x+k]<127.5?255*(1-(255-l[c+k])/(2*p[x+k])):l[c+k]/(2*(1-p[x+k]/255)),l[c+k]=(1-a)*l[c+k]+a*d);break;case"线性光":if(I[k]){var L=l[c+k]+2*p[x+k]-255;d=L>255?255:L,l[c+k]=(1-a)*l[c+k]+a*d}break;case"实色混合":I[k]&&(d=p[x+k]<255-l[c+k]?0:255,l[c+k]=(1-a)*l[c+k]+a*d);break;default:I[k]&&(d=p[x+k],l[c+k]=(1-a)*l[c+k]+a*d)}return t}function s(t,s,n,r,o){var h=t.getImageData(s,n,r,o),c=t.getImageData(s,n,r,o);return h=i(h,10),h=a(h,c,"滤色"),h=e(h,-10,5)}function n(t,i){i=parseInt(i)||3;for(var e=t.data,a=t.width,s=t.height,n=2*i+1,r=0,o=parseInt(a/n);o>r;r++)for(var h=0,c=parseInt(s/n);c>h;h++){for(var l=[],p=[0,0,0],d=0;n>d;d++)for(var u=0;n>u;u++){var g=(h*n+d)*a+r*n+u;p[0]+=e[4*g],p[1]+=e[4*g+1],p[2]+=e[4*g+2]}l[0]=p[0]/(n*n),l[1]=p[1]/(n*n),l[2]=p[2]/(n*n);for(var d=0;n>d;d++)for(var u=0;n>u;u++){var g=(h*n+d)*a+r*n+u;e[4*g]=l[0],e[4*g+1]=l[1],e[4*g+2]=l[2]}}return t}function r(t,i,e){var a=[];if(i){if(isNaN(i))var s=/(\d+)\*/.exec(i)[1],n=/\*(\d+)/.exec(i)[1];else s=i,n=e;if(t[0]&&t[0][0])for(var r=0;s>r;r++){a[r]=[];for(var o=0;n>o;o++)a[r][o]=t[r][o]||0}else for(var r=0;s>r;r++){a[r]=[];for(var o=0;n>o;o++){a[r][o]=t[r*n+o]||0}}this.m=s,this.n=n}else this.m=t.length,this.n=t[0].length;this.data=a}function o(t,i,e){e=e||0;for(var a=t.data,s=t.width,n=(t.height,i.length),o=new r(i,n,1),h=[],c=-(Math.sqrt(n)-1)/2,l=0,p=a.length;p>l;l+=4){var d=l/4,u=parseInt(d/s),g=d%s;if(0!=u&&0!=g){for(var f=[[],[],[]],m=c;-c>=m;m++)for(var v=u+m,w=c;-c>=w;w++)for(var x=g+w,b=4*(v*s+x),C=0;3>C;C++){var B=b+C;f[C].push(a[B])}for(var y=new r(f,3,n),D=y.mutiply(o),C=0;3>C;C++)h[l+C]=D.data[C];h[l+4]=a[l+4]}}for(var l=0,p=a.length;p>l;l++)h[l]&&(a[l]=h[l]<e?h[l]:a[l]);return t}function h(t){var i=[0,1,0,1,-4,1,0,1,0];return o(t,i,250)}function c(t){for(var i=t.data,e=t.width,a=(t.height,[]),s=0,n=i.length;n>s;s+=4){var r=s/4,o=parseInt(r/e),h=r%e,c=4*((o-1)*e+(h-1)),l=(o+1)*e*4+4*(h+1);if(0!=o&&0!=h){for(var p=0;3>p;p++)a[s+p]=i[c+p]-i[l+p]+127.5;a[s+4]=i[s+4]}}for(var s=0,n=i.length;n>s;s++)i[s]=a[s]||i[s];return t}function l(t,i,e,s,r){var o=t.getImageData(i,e,s,r),l=t.getImageData(i,e,s,r);return l=c(h(n(l))),o=a(o,l,"线性光")}function p(t){for(var i=t.data,e=0,a=i.length;a>e;e+=4){var s=parseInt(.299*i[e]+.578*i[e+1]+.114*i[e+2]);i[e+2]=i[e+1]=i[e]=s}return t}function d(t,i,e,a,s){var n=t.getImageData(i,e,a,s);return n=p(n)}function u(t,i){function e(i,e){for(var s=1,n=1,r=0;a>r;r++)r!=e&&(s*=t[e]-t[r],n*=i-t[r]);var o=n/s;return o}var a=t.length,s=function(t){for(var s=0,n=0;a>n;n++){var r=e(t,n);s+=i[n]*r}return s};return s}function g(t,i,e){for(var a=u(i,e),s=t.data,n=t.width,r=t.height,o=0;n>o;o++)for(var h=0;r>h;h++)for(var c=h*n+o,l=0;3>l;l++)s[4*c+l]=a(s[4*c+l]);return t}function f(t,i,e,a,s){var n=t.getImageData(i,e,a,s);return n=g(p(n),[0,60,142,194,255],[0,194,240,247,255])}function m(t){for(var i=t.data,e=0,a=i.length;a>e;e+=4)i[e]=255-i[e],i[e+1]=255-i[e+1],i[e+2]=255-i[e+2];return t}function v(t,i){this.r=t||0,this.i=i||0}function w(t,i){i=i||[0,0],t=new v(t[0],t[1]),i=new v(i[0],i[1]);var e=t.minus(i);return e.distance()}function x(t,i,e,a){function s(t,i,a){var s=w([t,i],[h,c]),n=(s-p)/(l-p);return 0>n&&(n=0),d(n,0,.02,.3,1)*a*e/255}i=parseInt(i)||3,a=a||"round",e=e||30;for(var n=t.data,r=t.width,o=t.height,h=2*r/3,c=1*o/2,l=w([h,c]),p=l*(1-i/10),d=function(t,i,e,a,s){return i*Math.pow(1-t,3)+3*e*t*Math.pow(1-t,2)+3*a*t*t*(1-t)+s*Math.pow(t,3)},u=0;r>u;u++)for(var g=0;o>g;g++)for(var f=g*r+u,m=0;3>m;m++){var v=s(u,g,n[4*f+m]);n[4*f+m]-=v}return t}function b(t,i,e,s,n){{var r=t.getImageData(i,e,s,n),o=t.getImageData(i,e,s,n);t.getImageData(i,e,s,n),t.getImageData(i,e,s,n)}return r=a(r,o,"滤色"),r=a(r,o,"柔光"),o=m(o),r=a(r,o,"正常","20%","B"),r=x(r,6,200)}function C(t,e,s,n,r){var o=t.getImageData(e,s,n,r),h=t.getImageData(e,s,n,r);return o=i(o,3),o=a(o,h,"正片叠底","RG")}function B(t){return function(i,e,a){return a=a||0,4*(e*t+i)+a}}function y(t,i,e){i=parseInt(i)||1,e=parseInt(e)||1;for(var a=t.data,s=t.width,n=t.height,r=2*i+1,o=[],h=e*e,c=-i;i>c;c++)for(var l=-i;i>l;l++)c*c+l*l>h&&o.push([c,l]);for(var p=B(s),c=0,d=parseInt(s/r);d>c;c++)for(var l=0,u=parseInt(n/r);u>l;l++)for(var g=parseInt((c+.5)*r),f=parseInt((l+.5)*r),m=0;m<o.length;m++){var v=g+o[m][0],w=f+o[m][1];a[p(v,w,3)]=225,a[p(v,w,2)]=225,a[p(v,w,0)]=225,a[p(v,w,1)]=225}return t}function D(t,i,e,s,n){for(var r=t.getImageData(i,e,s,n),o=t.createImageData(r.width,r.height),h=0,l=o.data.length;l>=h;h+=4)o.data[h]=0,o.data[h+1]=0,o.data[h+2]=0,o.data[h+3]=255;return o=c(m(y(o))),r=a(r,o,"叠加")}function I(t,i){i=i||.6;for(var e=t.data,a=t.width,s=(t.height,0),n=e.length;n>s;s+=4){var r=s/4,o=parseInt(r/a),h=r%a;if(0!=o&&0!=h)for(var c=4*((o-1)*a+(h-1)),l=4*((o-1)*a+h),p=4*(r-1),d=0;3>d;d++){var u=e[s+d]-(e[l+d]+e[p+d]+e[c+d])/3;e[s+d]+=u*i}}return t}function M(t,e,s,n,r){var o=t.getImageData(e,s,n,r),h=t.getImageData(e,s,n,r);return h=i(m(h),8),o=a(o,h,"颜色减淡"),o=I(p(o),1)}function $(t,e,s,n,r){var o=t.getImageData(e,s,n,r),h=t.getImageData(e,s,n,r);return o=i(o,6),o=a(o,h,"变暗")}function k(t,i,e,a,s){var n=t.getImageData(i,e,a,s);return n=g(n,[0,190,255],[0,229,255])}function L(t,i,e,s,n){var r=t.getImageData(i,e,s,n),o=t.getImageData(i,e,s,n);return o=g(o,[0,50,255],[0,234,255]),r=a(r,o,"柔光")}function T(t,i,e,a,s){var n=t.getImageData(i,e,a,s);return n=g(p(n),[0,61,69,212,255],[0,111,176,237,255])}function R(t,i,e){var a=(t-i+t-e)/2/Math.sqrt((t-i)*(t-i)+(t-e)*(i-e))||0;a=Math.acos(a);var s=e>i?2*Math.PI-a:a,n=1-3*Math.min(t,i,e)/(t+i+e),r=(t+i+e)/3;return s>2*Math.PI&&(s=2*Math.PI),0>s&&(s=0),{H:s,S:n,I:r}}function X(t,i,e){if(0>t?(t%=2*Math.PI,t+=2*Math.PI):t%=2*Math.PI,t<=2*Math.PI/3)var a=e*(1-i),s=e*(1+i*Math.cos(t)/Math.cos(Math.PI/3-t)),n=3*e-(s+a);else if(t<=4*Math.PI/3){t-=2*Math.PI/3;var s=e*(1-i),n=e*(1+i*Math.cos(t)/Math.cos(Math.PI/3-t)),a=3*e-(n+s)}else{t-=4*Math.PI/3;var n=e*(1-i),a=e*(1+i*Math.cos(t)/Math.cos(Math.PI/3-t)),s=3*e-(n+a)}return{R:s,G:n,B:a}}function Y(t,i){for(var e=t.data,a=0,s=e.length;s>a;a+=4){var n=R(e[a],e[a+1],e[a+2]);i(n),n.S>1&&(n.S=1),n.S<0&&(n.S=0);var r=X(n.H,n.S,n.I);e[a]=r.R,e[a+1]=r.G,e[a+2]=r.B}return t}function P(t,i,e,a,s){return i=i/180*Math.PI,e=e/100||0,a=a/100*255||0,s=s||!1,Y(t,function(t){s?(t.H=i,t.S=e,t.I+=a):(t.H+=i,t.S+=e,t.I+=a)}),t}function W(t,i){i=parseInt(i)||100;for(var e=t.data,a=t.width,s=t.height,n=0;a>n;n++)for(var r=0;s>r;r++)for(var o=r*a+n,h=0;3>h;h++){var c=parseInt(Math.random()*i*2)-i;e[4*o+h]+=c}return t}function H(t,e,s,n,r){for(var o=t.getImageData(e,s,n,r),h=t.createImageData(o.width,o.height),c=0,l=h.data.length;l>=c;c+=4)h.data[c]=128,h.data[c+1]=128,h.data[c+2]=128,h.data[c+3]=255;return h=i(W(h),4),h=P(h,32,19,0,!0),o=p(o),o=a(o,h,"叠加")}function z(t,i,e,s,n){var r=t.getImageData(i,e,s,n),o=t.getImageData(i,e,s,n);return o=x(P(o,36,47,8,!0),6,150),r=a(r,o,"叠加")}r.prototype={plus:function(t){if(this.m!=t.m||this.n!=t.n)throw new Error("矩阵加法行列不匹配");for(var i=new r([],this.m,this.n),e=0;e<this.m;e++)for(var a=0;a<this.n;a++)i.data[e][a]=this.data[e][a]+t.data[e][a];return i},minus:function(t){if(this.m!=t.m||this.n!=t.n)throw new Error("矩阵减法法行列不匹配");for(var i=new r([],this.m,this.n),e=0;e<this.m;e++)for(var a=0;a<this.n;a++)i.data[e][a]=this.data[e][a]-t.data[e][a];return i},mutiply:function(t){if(this.n!=t.m)throw new Error("矩阵乘法行列不匹配");for(var i=new r([],this.m,t.n),e=0;e<this.m;e++)for(var a=0;a<t.n;a++){for(var s=0,n=0;n<this.n;n++)s+=this.data[e][n]*t.data[n][a];i.data[e][a]=s}return i}},v.prototype={plus:function(t){var i=new v;return i.r=this.r+t.r,i.i=this.i+t.i,i},minus:function(t){var i=new v;return i.r=this.r-t.r,i.i=this.i-t.i,i},mutiply:function(t){var i=new v;return i.r=this.r*t.r-this.i*t.i,i.i=this.r*t.i+this.i*t.r,i},divide:function(t){var i=new v,e=t.mutiply(t.conjugated()),a=this.mutiply(t.conjugated());return i.r=a.r/e.r,i.i=a.i/e.r,i},conjugated:function(){var t=new v(this.r,-this.i);return t},distance:function(){return Math.sqrt(this.r*this.r+this.i*this.i)}};var U={softenFace:s,carveStyle:l,gray:d,lightGray:f,lomo:b,purpleStyle:C,rough:D,sketch:M,soften:$,softEnhancement:k,strongEnhancement:L,strongGray:T,vintage:H,warmAutumn:z};t.effects=U}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){"use strict";function i(t){return"number"==typeof t&&!isNaN(t)}function e(t){return"undefined"==typeof t}function a(t,e){var a=[];return i(e)&&a.push(e),a.slice.apply(t,a)}function s(t,i){var e=a(arguments,2);return function(){return t.apply(i,e.concat(a(arguments)))}}function n(t){var i=t.match(/^(https?:)\/\/([^\:\/\?#]+):?(\d*)/i);return i&&(i[1]!==b.protocol||i[2]!==b.hostname||i[3]!==b.port)}function r(t){var i="timestamp="+(new Date).getTime();return t+(-1===t.indexOf("?")?"?":"&")+i}function o(t){return t?' crossOrigin="'+t+'"':""}function h(t,i){var e;return t.naturalWidth&&!mi?i(t.naturalWidth,t.naturalHeight):(e=document.createElement("img"),e.onload=function(){i(this.width,this.height)},void(e.src=t.src))}function c(t){var e=[],a=t.rotate,s=t.scaleX,n=t.scaleY;return i(a)&&0!==a&&e.push("rotate("+a+"deg)"),i(s)&&1!==s&&e.push("scaleX("+s+")"),i(n)&&1!==n&&e.push("scaleY("+n+")"),e.length?e.join(" "):"none"}function l(t,i){var e,a,s=bi(t.degree)%180,n=(s>90?180-s:s)*Math.PI/180,r=Ci(n),o=Bi(n),h=t.width,c=t.height,l=t.aspectRatio;return i?(e=h/(o+r/l),a=e/l):(e=h*o+c*r,a=h*r+c*o),{width:e,height:a}}function p(e,a){var s,n,r,o=t("<canvas>")[0],h=o.getContext("2d"),c=0,p=0,d=a.naturalWidth,u=a.naturalHeight,g=a.rotate,f=a.scaleX,m=a.scaleY,v=i(f)&&i(m)&&(1!==f||1!==m),w=i(g)&&0!==g,x=w||v,b=d*bi(f||1),C=u*bi(m||1);return v&&(s=b/2,n=C/2),w&&(r=l({width:b,height:C,degree:g}),b=r.width,C=r.height,s=b/2,n=C/2),o.width=b,o.height=C,x&&(c=-d/2,p=-u/2,h.save(),h.translate(s,n)),w&&h.rotate(g*Math.PI/180),v&&h.scale(f,m),h.drawImage(e,Ii(c),Ii(p),Ii(d),Ii(u)),x&&h.restore(),o}function d(i){var e=i.length,a=0,s=0;return e&&(t.each(i,function(t,i){a+=i.pageX,s+=i.pageY}),a/=e,s/=e),{pageX:a,pageY:s}}function u(t,i,e){var a,s="";for(a=i,e+=i;e>a;a++)s+=Mi(t.getUint8(a));return s}function g(t){var i,e,a,s,n,r,o,h,c,l,p=new D(t),d=p.byteLength;if(255===p.getUint8(0)&&216===p.getUint8(1))for(c=2;d>c;){if(255===p.getUint8(c)&&225===p.getUint8(c+1)){o=c;break}c++}if(o&&(e=o+4,a=o+10,"Exif"===u(p,e,4)&&(r=p.getUint16(a),n=18761===r,(n||19789===r)&&42===p.getUint16(a+2,n)&&(s=p.getUint32(a+4,n),s>=8&&(h=a+s)))),h)for(d=p.getUint16(h,n),l=0;d>l;l++)if(c=h+12*l+2,274===p.getUint16(c,n)){c+=8,i=p.getUint16(c,n),mi&&p.setUint16(c,1,n);break}return i}function f(t){var i,e=t.replace(V,""),a=atob(e),s=a.length,n=new B(s),r=new y(n);for(i=0;s>i;i++)r[i]=a.charCodeAt(i);return n}function m(t){var i,e=new y(t),a=e.length,s="";for(i=0;a>i;i++)s+=Mi(e[i]);return"data:image/jpeg;base64,"+I(s)}function v(i,e){this.$element=t(i),this.options=t.extend({},v.DEFAULTS,t.isPlainObject(e)&&e),this.isLoaded=!1,this.isBuilt=!1,this.isCompleted=!1,this.isRotated=!1,this.isCropped=!1,this.isDisabled=!1,this.isReplaced=!1,this.isLimited=!1,this.wheeling=!1,this.isImg=!1,this.originalUrl="",this.canvas=null,this.cropBox=null,this.init()}var w=t(window),x=t(document),b=window.location,C=window.navigator,B=window.ArrayBuffer,y=window.Uint8Array,D=window.DataView,I=window.btoa,M="cropper",$="cropper-modal",k="cropper-hide",L="cropper-hidden",T="cropper-invisible",R="cropper-move",X="cropper-crop",Y="cropper-disabled",P="cropper-bg",W="mousedown touchstart pointerdown MSPointerDown",H="mousemove touchmove pointermove MSPointerMove",z="mouseup touchend touchcancel pointerup pointercancel MSPointerUp MSPointerCancel",U="wheel mousewheel DOMMouseScroll",O="dblclick",E="load."+M,S="error."+M,A="resize."+M,F="build."+M,j="built."+M,G="cropstart."+M,q="cropmove."+M,_="cropend."+M,N="crop."+M,K="zoom."+M,Z=/^(e|w|s|n|se|sw|ne|nw|all|crop|move|zoom)$/,Q=/^data:/,V=/^data:([^;]+);base64,/,J=/^data:image\/jpeg.*;base64,/,ti="preview",ii="action",ei="e",ai="w",si="s",ni="n",ri="se",oi="sw",hi="ne",ci="nw",li="all",pi="crop",di="move",ui="zoom",gi="none",fi=t.isFunction(t("<canvas>")[0].getContext),mi=C&&/(Macintosh|iPhone|iPod|iPad).*AppleWebKit/i.test(C.userAgent),vi=Number,wi=Math.min,xi=Math.max,bi=Math.abs,Ci=Math.sin,Bi=Math.cos,yi=Math.sqrt,Di=Math.round,Ii=Math.floor,Mi=String.fromCharCode;v.prototype={constructor:v,init:function(){var t,i=this.$element;if(i.is("img")){if(this.isImg=!0,this.originalUrl=t=i.attr("src"),!t)return;t=i.prop("src")}else i.is("canvas")&&fi&&(t=i[0].toDataURL());this.load(t)},trigger:function(i,e){var a=t.Event(i,e);return this.$element.trigger(a),a},load:function(i){var e,a,s=this.options,o=this.$element;if(i&&(o.one(F,s.build),!this.trigger(F).isDefaultPrevented())){if(this.url=i,this.image={},!s.checkOrientation||!B)return this.clone();if(e=t.proxy(this.read,this),Q.test(i))return J.test(i)?e(f(i)):this.clone();a=new XMLHttpRequest,a.onerror=a.onabort=t.proxy(function(){this.clone()},this),a.onload=function(){e(this.response)},s.checkCrossOrigin&&n(i)&&o.prop("crossOrigin")&&(i=r(i)),a.open("get",i),a.responseType="arraybuffer",a.send()}},read:function(t){var i=this.options,e=g(t),a=this.image,s=0,n=1,r=1;if(e>1)switch(this.url=m(t),e){case 2:n=-1;break;case 3:s=-180;break;case 4:r=-1;break;case 5:s=90,r=-1;break;case 6:s=90;break;case 7:s=90,n=-1;break;case 8:s=-90}i.rotatable&&(a.rotate=s),i.scalable&&(a.scaleX=n,a.scaleY=r),this.clone()},clone:function(){var i,e,a=this.options,s=this.$element,h=this.url,c="";a.checkCrossOrigin&&n(h)&&(c=s.prop("crossOrigin"),c?i=h:(c="anonymous",i=r(h))),this.crossOrigin=c,this.crossOriginUrl=i,this.$clone=e=t("<img"+o(c)+' src="'+(i||h)+'">'),this.isImg?s[0].complete?this.start():s.one(E,t.proxy(this.start,this)):e.one(E,t.proxy(this.start,this)).one(S,t.proxy(this.stop,this)).addClass(k).insertAfter(s)},start:function(){var i=this.$element,e=this.$clone;this.isImg||(e.off(S,this.stop),i=e),h(i[0],t.proxy(function(i,e){t.extend(this.image,{naturalWidth:i,naturalHeight:e,aspectRatio:i/e}),this.isLoaded=!0,this.build()},this))},stop:function(){this.$clone.remove(),this.$clone=null},build:function(){var i,e,a,s=this.options,n=this.$element,r=this.$clone;this.isLoaded&&(this.isBuilt&&this.unbuild(),this.$container=n.parent(),this.$cropper=i=t(v.TEMPLATE),this.$canvas=i.find(".cropper-canvas").append(r),this.$dragBox=i.find(".cropper-drag-box"),this.$cropBox=e=i.find(".cropper-crop-box"),this.$viewBox=i.find(".cropper-view-box"),this.$face=a=e.find(".cropper-face"),n.addClass(L).after(i),this.isImg||r.removeClass(k),this.initPreview(),this.bind(),s.aspectRatio=xi(0,s.aspectRatio)||0/0,s.viewMode=xi(0,wi(3,Di(s.viewMode)))||0,s.autoCrop?(this.isCropped=!0,s.modal&&this.$dragBox.addClass($)):e.addClass(L),s.guides||e.find(".cropper-dashed").addClass(L),s.center||e.find(".cropper-center").addClass(L),s.cropBoxMovable&&a.addClass(R).data(ii,li),s.highlight||a.addClass(T),s.background&&i.addClass(P),s.cropBoxResizable||e.find(".cropper-line, .cropper-point").addClass(L),this.setDragMode(s.dragMode),this.render(),this.isBuilt=!0,this.setData(s.data),n.one(j,s.built),this.completing=setTimeout(t.proxy(function(){this.trigger(j),this.trigger(N,this.getData()),this.isCompleted=!0},this),0))},unbuild:function(){this.isBuilt&&(this.isCompleted||clearTimeout(this.completing),this.isBuilt=!1,this.isCompleted=!1,this.initialImage=null,this.initialCanvas=null,this.initialCropBox=null,this.container=null,this.canvas=null,this.cropBox=null,this.unbind(),this.resetPreview(),this.$preview=null,this.$viewBox=null,this.$cropBox=null,this.$dragBox=null,this.$canvas=null,this.$container=null,this.$cropper.remove(),this.$cropper=null)},render:function(){this.initContainer(),this.initCanvas(),this.initCropBox(),this.renderCanvas(),this.isCropped&&this.renderCropBox()},initContainer:function(){var t=this.options,i=this.$element,e=this.$container,a=this.$cropper;a.addClass(L),i.removeClass(L),a.css(this.container={width:xi(e.width(),vi(t.minContainerWidth)||200),height:xi(e.height(),vi(t.minContainerHeight)||100)}),i.addClass(L),a.removeClass(L)},initCanvas:function(){var i,e=this.options.viewMode,a=this.container,s=a.width,n=a.height,r=this.image,o=r.naturalWidth,h=r.naturalHeight,c=90===bi(r.rotate),l=c?h:o,p=c?o:h,d=l/p,u=s,g=n;n*d>s?3===e?u=n*d:g=s/d:3===e?g=s/d:u=n*d,i={naturalWidth:l,naturalHeight:p,aspectRatio:d,width:u,height:g},i.oldLeft=i.left=(s-u)/2,i.oldTop=i.top=(n-g)/2,this.canvas=i,this.isLimited=1===e||2===e,this.limitCanvas(!0,!0),this.initialImage=t.extend({},r),this.initialCanvas=t.extend({},i)},limitCanvas:function(t,i){var e,a,s,n,r=this.options,o=r.viewMode,h=this.container,c=h.width,l=h.height,p=this.canvas,d=p.aspectRatio,u=this.cropBox,g=this.isCropped&&u;t&&(e=vi(r.minCanvasWidth)||0,a=vi(r.minCanvasHeight)||0,o&&(o>1?(e=xi(e,c),a=xi(a,l),3===o&&(a*d>e?e=a*d:a=e/d)):e?e=xi(e,g?u.width:0):a?a=xi(a,g?u.height:0):g&&(e=u.width,a=u.height,a*d>e?e=a*d:a=e/d)),e&&a?a*d>e?a=e/d:e=a*d:e?a=e/d:a&&(e=a*d),p.minWidth=e,p.minHeight=a,p.maxWidth=1/0,p.maxHeight=1/0),i&&(o?(s=c-p.width,n=l-p.height,p.minLeft=wi(0,s),p.minTop=wi(0,n),p.maxLeft=xi(0,s),p.maxTop=xi(0,n),g&&this.isLimited&&(p.minLeft=wi(u.left,u.left+u.width-p.width),p.minTop=wi(u.top,u.top+u.height-p.height),p.maxLeft=u.left,p.maxTop=u.top,2===o&&(p.width>=c&&(p.minLeft=wi(0,s),p.maxLeft=xi(0,s)),p.height>=l&&(p.minTop=wi(0,n),p.maxTop=xi(0,n))))):(p.minLeft=-p.width,p.minTop=-p.height,p.maxLeft=c,p.maxTop=l))},renderCanvas:function(t){var i,e,a=this.canvas,s=this.image,n=s.rotate,r=s.naturalWidth,o=s.naturalHeight;this.isRotated&&(this.isRotated=!1,e=l({width:s.width,height:s.height,degree:n}),i=e.width/e.height,i!==a.aspectRatio&&(a.left-=(e.width-a.width)/2,a.top-=(e.height-a.height)/2,a.width=e.width,a.height=e.height,a.aspectRatio=i,a.naturalWidth=r,a.naturalHeight=o,n%180&&(e=l({width:r,height:o,degree:n}),a.naturalWidth=e.width,a.naturalHeight=e.height),this.limitCanvas(!0,!1))),(a.width>a.maxWidth||a.width<a.minWidth)&&(a.left=a.oldLeft),(a.height>a.maxHeight||a.height<a.minHeight)&&(a.top=a.oldTop),a.width=wi(xi(a.width,a.minWidth),a.maxWidth),a.height=wi(xi(a.height,a.minHeight),a.maxHeight),this.limitCanvas(!1,!0),a.oldLeft=a.left=wi(xi(a.left,a.minLeft),a.maxLeft),a.oldTop=a.top=wi(xi(a.top,a.minTop),a.maxTop),this.$canvas.css({width:a.width,height:a.height,left:a.left,top:a.top}),this.renderImage(),this.isCropped&&this.isLimited&&this.limitCropBox(!0,!0),t&&this.output()},renderImage:function(i){var e,a=this.canvas,s=this.image;s.rotate&&(e=l({width:a.width,height:a.height,degree:s.rotate,aspectRatio:s.aspectRatio},!0)),t.extend(s,e?{width:e.width,height:e.height,left:(a.width-e.width)/2,top:(a.height-e.height)/2}:{width:a.width,height:a.height,left:0,top:0}),this.$clone.css({width:s.width,height:s.height,marginLeft:s.left,marginTop:s.top,transform:c(s)}),i&&this.output()},initCropBox:function(){var i=this.options,e=this.canvas,a=i.aspectRatio,s=vi(i.autoCropArea)||.8,n={width:e.width,height:e.height};a&&(e.height*a>e.width?n.height=n.width/a:n.width=n.height*a),this.cropBox=n,this.limitCropBox(!0,!0),n.width=wi(xi(n.width,n.minWidth),n.maxWidth),n.height=wi(xi(n.height,n.minHeight),n.maxHeight),n.width=xi(n.minWidth,n.width*s),n.height=xi(n.minHeight,n.height*s),n.oldLeft=n.left=e.left+(e.width-n.width)/2,n.oldTop=n.top=e.top+(e.height-n.height)/2,this.initialCropBox=t.extend({},n)},limitCropBox:function(t,i){var e,a,s,n,r=this.options,o=r.aspectRatio,h=this.container,c=h.width,l=h.height,p=this.canvas,d=this.cropBox,u=this.isLimited;t&&(e=vi(r.minCropBoxWidth)||0,a=vi(r.minCropBoxHeight)||0,e=wi(e,c),a=wi(a,l),s=wi(c,u?p.width:c),n=wi(l,u?p.height:l),o&&(e&&a?a*o>e?a=e/o:e=a*o:e?a=e/o:a&&(e=a*o),n*o>s?n=s/o:s=n*o),d.minWidth=wi(e,s),d.minHeight=wi(a,n),d.maxWidth=s,d.maxHeight=n),i&&(u?(d.minLeft=xi(0,p.left),d.minTop=xi(0,p.top),d.maxLeft=wi(c,p.left+p.width)-d.width,d.maxTop=wi(l,p.top+p.height)-d.height):(d.minLeft=0,d.minTop=0,d.maxLeft=c-d.width,d.maxTop=l-d.height))},renderCropBox:function(){var t=this.options,i=this.container,e=i.width,a=i.height,s=this.cropBox;(s.width>s.maxWidth||s.width<s.minWidth)&&(s.left=s.oldLeft),(s.height>s.maxHeight||s.height<s.minHeight)&&(s.top=s.oldTop),s.width=wi(xi(s.width,s.minWidth),s.maxWidth),s.height=wi(xi(s.height,s.minHeight),s.maxHeight),this.limitCropBox(!1,!0),s.oldLeft=s.left=wi(xi(s.left,s.minLeft),s.maxLeft),s.oldTop=s.top=wi(xi(s.top,s.minTop),s.maxTop),t.movable&&t.cropBoxMovable&&this.$face.data(ii,s.width===e&&s.height===a?di:li),this.$cropBox.css({width:s.width,height:s.height,left:s.left,top:s.top}),this.isCropped&&this.isLimited&&this.limitCanvas(!0,!0),this.isDisabled||this.output()},output:function(){this.preview(),this.isCompleted&&this.trigger(N,this.getData())},initPreview:function(){var i,e=o(this.crossOrigin),a=e?this.crossOriginUrl:this.url;this.$preview=t(this.options.preview),this.$clone2=i=t("<img"+e+' src="'+a+'">'),this.$viewBox.html(i),this.$preview.each(function(){var i=t(this);i.data(ti,{width:i.width(),height:i.height(),html:i.html()}),i.html("<img"+e+' src="'+a+'" style="display:block;width:100%;height:auto;min-width:0!important;min-height:0!important;max-width:none!important;max-height:none!important;image-orientation:0deg!important;">')})},resetPreview:function(){this.$preview.each(function(){var i=t(this),e=i.data(ti);i.css({width:e.width,height:e.height}).html(e.html).removeData(ti)})},preview:function(){var i=this.image,e=this.canvas,a=this.cropBox,s=a.width,n=a.height,r=i.width,o=i.height,h=a.left-e.left-i.left,l=a.top-e.top-i.top;this.isCropped&&!this.isDisabled&&(this.$clone2.css({width:r,height:o,marginLeft:-h,marginTop:-l,transform:c(i)}),this.$preview.each(function(){var e=t(this),a=e.data(ti),p=a.width,d=a.height,u=p,g=d,f=1;s&&(f=p/s,g=n*f),n&&g>d&&(f=d/n,u=s*f,g=d),e.css({width:u,height:g}).find("img").css({width:r*f,height:o*f,marginLeft:-h*f,marginTop:-l*f,transform:c(i)})}))},bind:function(){var i=this.options,e=this.$element,a=this.$cropper;t.isFunction(i.cropstart)&&e.on(G,i.cropstart),t.isFunction(i.cropmove)&&e.on(q,i.cropmove),t.isFunction(i.cropend)&&e.on(_,i.cropend),t.isFunction(i.crop)&&e.on(N,i.crop),t.isFunction(i.zoom)&&e.on(K,i.zoom),a.on(W,t.proxy(this.cropStart,this)),i.zoomable&&i.zoomOnWheel&&a.on(U,t.proxy(this.wheel,this)),i.toggleDragModeOnDblclick&&a.on(O,t.proxy(this.dblclick,this)),x.on(H,this._cropMove=s(this.cropMove,this)).on(z,this._cropEnd=s(this.cropEnd,this)),i.responsive&&w.on(A,this._resize=s(this.resize,this))},unbind:function(){var i=this.options,e=this.$element,a=this.$cropper;t.isFunction(i.cropstart)&&e.off(G,i.cropstart),t.isFunction(i.cropmove)&&e.off(q,i.cropmove),t.isFunction(i.cropend)&&e.off(_,i.cropend),t.isFunction(i.crop)&&e.off(N,i.crop),t.isFunction(i.zoom)&&e.off(K,i.zoom),a.off(W,this.cropStart),i.zoomable&&i.zoomOnWheel&&a.off(U,this.wheel),i.toggleDragModeOnDblclick&&a.off(O,this.dblclick),x.off(H,this._cropMove).off(z,this._cropEnd),i.responsive&&w.off(A,this._resize)},resize:function(){var i,e,a,s=this.options.restore,n=this.$container,r=this.container;!this.isDisabled&&r&&(a=n.width()/r.width,(1!==a||n.height()!==r.height)&&(s&&(i=this.getCanvasData(),e=this.getCropBoxData()),this.render(),s&&(this.setCanvasData(t.each(i,function(t,e){i[t]=e*a})),this.setCropBoxData(t.each(e,function(t,i){e[t]=i*a})))))},dblclick:function(){this.isDisabled||this.setDragMode(this.$dragBox.hasClass(X)?di:pi)},wheel:function(i){var e=i.originalEvent||i,a=vi(this.options.wheelZoomRatio)||.1,s=1;this.isDisabled||(i.preventDefault(),this.wheeling||(this.wheeling=!0,setTimeout(t.proxy(function(){this.wheeling=!1},this),50),e.deltaY?s=e.deltaY>0?1:-1:e.wheelDelta?s=-e.wheelDelta/120:e.detail&&(s=e.detail>0?1:-1),this.zoom(-s*a,i)))},cropStart:function(i){var e,a,s=this.options,n=i.originalEvent,r=n&&n.touches,o=i;if(!this.isDisabled){if(r){if(e=r.length,e>1){if(!s.zoomable||!s.zoomOnTouch||2!==e)return;o=r[1],this.startX2=o.pageX,this.startY2=o.pageY,a=ui}o=r[0]}if(a=a||t(o.target).data(ii),Z.test(a)){if(this.trigger(G,{originalEvent:n,action:a}).isDefaultPrevented())return;i.preventDefault(),this.action=a,this.cropping=!1,this.startX=o.pageX||n&&n.pageX,this.startY=o.pageY||n&&n.pageY,a===pi&&(this.cropping=!0,this.$dragBox.addClass($))}}},cropMove:function(t){var i,e=this.options,a=t.originalEvent,s=a&&a.touches,n=t,r=this.action;if(!this.isDisabled){if(s){if(i=s.length,i>1){if(!e.zoomable||!e.zoomOnTouch||2!==i)return;n=s[1],this.endX2=n.pageX,this.endY2=n.pageY}n=s[0]}if(r){if(this.trigger(q,{originalEvent:a,action:r}).isDefaultPrevented())return;t.preventDefault(),this.endX=n.pageX||a&&a.pageX,this.endY=n.pageY||a&&a.pageY,this.change(n.shiftKey,r===ui?t:null)}}},cropEnd:function(t){var i=t.originalEvent,e=this.action;this.isDisabled||e&&(t.preventDefault(),this.cropping&&(this.cropping=!1,this.$dragBox.toggleClass($,this.isCropped&&this.options.modal)),this.action="",this.trigger(_,{originalEvent:i,action:e}))},change:function(t,i){var e,a,s=this.options,n=s.aspectRatio,r=this.action,o=this.container,h=this.canvas,c=this.cropBox,l=c.width,p=c.height,d=c.left,u=c.top,g=d+l,f=u+p,m=0,v=0,w=o.width,x=o.height,b=!0;switch(!n&&t&&(n=l&&p?l/p:1),this.isLimited&&(m=c.minLeft,v=c.minTop,w=m+wi(o.width,h.width,h.left+h.width),x=v+wi(o.height,h.height,h.top+h.height)),a={x:this.endX-this.startX,y:this.endY-this.startY},n&&(a.X=a.y*n,a.Y=a.x/n),r){case li:d+=a.x,u+=a.y;break;case ei:if(a.x>=0&&(g>=w||n&&(v>=u||f>=x))){b=!1;break}l+=a.x,n&&(p=l/n,u-=a.Y/2),0>l&&(r=ai,l=0);break;case ni:if(a.y<=0&&(v>=u||n&&(m>=d||g>=w))){b=!1;break}p-=a.y,u+=a.y,n&&(l=p*n,d+=a.X/2),0>p&&(r=si,p=0);break;case ai:if(a.x<=0&&(m>=d||n&&(v>=u||f>=x))){b=!1;break}l-=a.x,d+=a.x,n&&(p=l/n,u+=a.Y/2),0>l&&(r=ei,l=0);break;case si:if(a.y>=0&&(f>=x||n&&(m>=d||g>=w))){b=!1;break}p+=a.y,n&&(l=p*n,d-=a.X/2),0>p&&(r=ni,p=0);break;case hi:if(n){if(a.y<=0&&(v>=u||g>=w)){b=!1;break}p-=a.y,u+=a.y,l=p*n}else a.x>=0?w>g?l+=a.x:a.y<=0&&v>=u&&(b=!1):l+=a.x,a.y<=0?u>v&&(p-=a.y,u+=a.y):(p-=a.y,u+=a.y);0>l&&0>p?(r=oi,p=0,l=0):0>l?(r=ci,l=0):0>p&&(r=ri,p=0);break;case ci:if(n){if(a.y<=0&&(v>=u||m>=d)){b=!1;break}p-=a.y,u+=a.y,l=p*n,d+=a.X}else a.x<=0?d>m?(l-=a.x,d+=a.x):a.y<=0&&v>=u&&(b=!1):(l-=a.x,d+=a.x),a.y<=0?u>v&&(p-=a.y,u+=a.y):(p-=a.y,u+=a.y);0>l&&0>p?(r=ri,p=0,l=0):0>l?(r=hi,l=0):0>p&&(r=oi,p=0);break;case oi:if(n){if(a.x<=0&&(m>=d||f>=x)){b=!1;break}l-=a.x,d+=a.x,p=l/n}else a.x<=0?d>m?(l-=a.x,d+=a.x):a.y>=0&&f>=x&&(b=!1):(l-=a.x,d+=a.x),a.y>=0?x>f&&(p+=a.y):p+=a.y;0>l&&0>p?(r=hi,p=0,l=0):0>l?(r=ri,l=0):0>p&&(r=ci,p=0);break;case ri:if(n){if(a.x>=0&&(g>=w||f>=x)){b=!1;break}l+=a.x,p=l/n}else a.x>=0?w>g?l+=a.x:a.y>=0&&f>=x&&(b=!1):l+=a.x,a.y>=0?x>f&&(p+=a.y):p+=a.y;0>l&&0>p?(r=ci,p=0,l=0):0>l?(r=oi,l=0):0>p&&(r=hi,p=0);break;case di:this.move(a.x,a.y),b=!1;break;case ui:this.zoom(function(t,i,e,a){var s=yi(t*t+i*i),n=yi(e*e+a*a);return(n-s)/s}(bi(this.startX-this.startX2),bi(this.startY-this.startY2),bi(this.endX-this.endX2),bi(this.endY-this.endY2)),i),this.startX2=this.endX2,this.startY2=this.endY2,b=!1;break;case pi:if(!a.x||!a.y){b=!1;break}e=this.$cropper.offset(),d=this.startX-e.left,u=this.startY-e.top,l=c.minWidth,p=c.minHeight,a.x>0?r=a.y>0?ri:hi:a.x<0&&(d-=l,r=a.y>0?oi:ci),a.y<0&&(u-=p),this.isCropped||(this.$cropBox.removeClass(L),this.isCropped=!0,this.isLimited&&this.limitCropBox(!0,!0))}b&&(c.width=l,c.height=p,c.left=d,c.top=u,this.action=r,this.renderCropBox()),this.startX=this.endX,this.startY=this.endY},crop:function(){this.isBuilt&&!this.isDisabled&&(this.isCropped||(this.isCropped=!0,this.limitCropBox(!0,!0),this.options.modal&&this.$dragBox.addClass($),this.$cropBox.removeClass(L)),this.setCropBoxData(this.initialCropBox))},reset:function(){this.isBuilt&&!this.isDisabled&&(this.image=t.extend({},this.initialImage),this.canvas=t.extend({},this.initialCanvas),this.cropBox=t.extend({},this.initialCropBox),this.renderCanvas(),this.isCropped&&this.renderCropBox())},clear:function(){this.isCropped&&!this.isDisabled&&(t.extend(this.cropBox,{left:0,top:0,width:0,height:0}),this.isCropped=!1,this.renderCropBox(),this.limitCanvas(!0,!0),this.renderCanvas(),this.$dragBox.removeClass($),this.$cropBox.addClass(L))},replace:function(t,i){!this.isDisabled&&t&&(this.isImg&&this.$element.attr("src",t),i?(this.url=t,this.$clone.attr("src",t),this.isBuilt&&this.$preview.find("img").add(this.$clone2).attr("src",t)):(this.isImg&&(this.isReplaced=!0),this.options.data=null,this.load(t)))},enable:function(){this.isBuilt&&(this.isDisabled=!1,this.$cropper.removeClass(Y))},disable:function(){this.isBuilt&&(this.isDisabled=!0,this.$cropper.addClass(Y))},destroy:function(){var t=this.$element;this.isLoaded?(this.isImg&&this.isReplaced&&t.attr("src",this.originalUrl),this.unbuild(),t.removeClass(L)):this.isImg?t.off(E,this.start):this.$clone&&this.$clone.remove(),t.removeData(M)},move:function(t,i){var a=this.canvas;
this.moveTo(e(t)?t:a.left+vi(t),e(i)?i:a.top+vi(i))},moveTo:function(t,a){var s=this.canvas,n=!1;e(a)&&(a=t),t=vi(t),a=vi(a),this.isBuilt&&!this.isDisabled&&this.options.movable&&(i(t)&&(s.left=t,n=!0),i(a)&&(s.top=a,n=!0),n&&this.renderCanvas(!0))},zoom:function(t,i){var e=this.canvas;t=vi(t),t=0>t?1/(1-t):1+t,this.zoomTo(e.width*t/e.naturalWidth,i)},zoomTo:function(t,i){var e,a,s,n,r,o=this.options,h=this.canvas,c=h.width,l=h.height,p=h.naturalWidth,u=h.naturalHeight;if(t=vi(t),t>=0&&this.isBuilt&&!this.isDisabled&&o.zoomable){if(a=p*t,s=u*t,i&&(e=i.originalEvent),this.trigger(K,{originalEvent:e,oldRatio:c/p,ratio:a/p}).isDefaultPrevented())return;e?(n=this.$cropper.offset(),r=e.touches?d(e.touches):{pageX:i.pageX||e.pageX||0,pageY:i.pageY||e.pageY||0},h.left-=(a-c)*((r.pageX-n.left-h.left)/c),h.top-=(s-l)*((r.pageY-n.top-h.top)/l)):(h.left-=(a-c)/2,h.top-=(s-l)/2),h.width=a,h.height=s,this.renderCanvas(!0)}},rotate:function(t){this.rotateTo((this.image.rotate||0)+vi(t))},rotateTo:function(t){t=vi(t),i(t)&&this.isBuilt&&!this.isDisabled&&this.options.rotatable&&(this.image.rotate=t%360,this.isRotated=!0,this.renderCanvas(!0))},scale:function(t,a){var s=this.image,n=!1;e(a)&&(a=t),t=vi(t),a=vi(a),this.isBuilt&&!this.isDisabled&&this.options.scalable&&(i(t)&&(s.scaleX=t,n=!0),i(a)&&(s.scaleY=a,n=!0),n&&this.renderImage(!0))},scaleX:function(t){var e=this.image.scaleY;this.scale(t,i(e)?e:1)},scaleY:function(t){var e=this.image.scaleX;this.scale(i(e)?e:1,t)},getData:function(i){var e,a,s=this.options,n=this.image,r=this.canvas,o=this.cropBox;return this.isBuilt&&this.isCropped?(a={x:o.left-r.left,y:o.top-r.top,width:o.width,height:o.height},e=n.width/n.naturalWidth,t.each(a,function(t,s){s/=e,a[t]=i?Di(s):s})):a={x:0,y:0,width:0,height:0},s.rotatable&&(a.rotate=n.rotate||0),s.scalable&&(a.scaleX=n.scaleX||1,a.scaleY=n.scaleY||1),a},setData:function(e){var a,s,n,r=this.options,o=this.image,h=this.canvas,c={};t.isFunction(e)&&(e=e.call(this.element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(r.rotatable&&i(e.rotate)&&e.rotate!==o.rotate&&(o.rotate=e.rotate,this.isRotated=a=!0),r.scalable&&(i(e.scaleX)&&e.scaleX!==o.scaleX&&(o.scaleX=e.scaleX,s=!0),i(e.scaleY)&&e.scaleY!==o.scaleY&&(o.scaleY=e.scaleY,s=!0)),a?this.renderCanvas():s&&this.renderImage(),n=o.width/o.naturalWidth,i(e.x)&&(c.left=e.x*n+h.left),i(e.y)&&(c.top=e.y*n+h.top),i(e.width)&&(c.width=e.width*n),i(e.height)&&(c.height=e.height*n),this.setCropBoxData(c))},getContainerData:function(){return this.isBuilt?this.container:{}},getImageData:function(){return this.isLoaded?this.image:{}},getCanvasData:function(){var i=this.canvas,e={};return this.isBuilt&&t.each(["left","top","width","height","naturalWidth","naturalHeight"],function(t,a){e[a]=i[a]}),e},setCanvasData:function(e){var a=this.canvas,s=a.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(a.left=e.left),i(e.top)&&(a.top=e.top),i(e.width)?(a.width=e.width,a.height=e.width/s):i(e.height)&&(a.height=e.height,a.width=e.height*s),this.renderCanvas(!0))},getCropBoxData:function(){var t,i=this.cropBox;return this.isBuilt&&this.isCropped&&(t={left:i.left,top:i.top,width:i.width,height:i.height}),t||{}},setCropBoxData:function(e){var a,s,n=this.cropBox,r=this.options.aspectRatio;t.isFunction(e)&&(e=e.call(this.$element)),this.isBuilt&&this.isCropped&&!this.isDisabled&&t.isPlainObject(e)&&(i(e.left)&&(n.left=e.left),i(e.top)&&(n.top=e.top),i(e.width)&&(a=!0,n.width=e.width),i(e.height)&&(s=!0,n.height=e.height),r&&(a?n.height=n.width/r:s&&(n.width=n.height*r)),this.renderCropBox())},getCroppedCanvas:function(i){var e,a,s,n,r,o,h,c,l,d,u;return this.isBuilt&&fi?this.isCropped?(t.isPlainObject(i)||(i={}),u=this.getData(),e=u.width,a=u.height,c=e/a,t.isPlainObject(i)&&(r=i.width,o=i.height,r?(o=r/c,h=r/e):o&&(r=o*c,h=o/a)),s=Ii(r||e),n=Ii(o||a),l=t("<canvas>")[0],l.width=s,l.height=n,d=l.getContext("2d"),i.fillColor&&(d.fillStyle=i.fillColor,d.fillRect(0,0,s,n)),d.drawImage.apply(d,function(){var t,i,s,n,r,o,c=p(this.$clone[0],this.image),l=c.width,d=c.height,g=this.canvas,f=[c],m=u.x+g.naturalWidth*(bi(u.scaleX||1)-1)/2,v=u.y+g.naturalHeight*(bi(u.scaleY||1)-1)/2;return-e>=m||m>l?m=t=s=r=0:0>=m?(s=-m,m=0,t=r=wi(l,e+m)):l>=m&&(s=0,t=r=wi(e,l-m)),0>=t||-a>=v||v>d?v=i=n=o=0:0>=v?(n=-v,v=0,i=o=wi(d,a+v)):d>=v&&(n=0,i=o=wi(a,d-v)),f.push(Ii(m),Ii(v),Ii(t),Ii(i)),h&&(s*=h,n*=h,r*=h,o*=h),r>0&&o>0&&f.push(Ii(s),Ii(n),Ii(r),Ii(o)),f}.call(this)),l):p(this.$clone[0],this.image):void 0},setAspectRatio:function(t){var i=this.options;this.isDisabled||e(t)||(i.aspectRatio=xi(0,t)||0/0,this.isBuilt&&(this.initCropBox(),this.isCropped&&this.renderCropBox()))},setDragMode:function(t){var i,e,a=this.options;this.isLoaded&&!this.isDisabled&&(i=t===pi,e=a.movable&&t===di,t=i||e?t:gi,this.$dragBox.data(ii,t).toggleClass(X,i).toggleClass(R,e),a.cropBoxMovable||this.$face.data(ii,t).toggleClass(X,i).toggleClass(R,e))}},v.DEFAULTS={viewMode:0,dragMode:"crop",aspectRatio:0/0,data:null,preview:"",responsive:!0,restore:!0,checkCrossOrigin:!0,checkOrientation:!0,modal:!0,guides:!0,center:!0,highlight:!0,background:!0,autoCrop:!0,autoCropArea:.8,movable:!0,rotatable:!0,scalable:!0,zoomable:!0,zoomOnTouch:!0,zoomOnWheel:!0,wheelZoomRatio:.1,cropBoxMovable:!0,cropBoxResizable:!0,toggleDragModeOnDblclick:!0,minCanvasWidth:0,minCanvasHeight:0,minCropBoxWidth:0,minCropBoxHeight:0,minContainerWidth:200,minContainerHeight:100,build:null,built:null,cropstart:null,cropmove:null,cropend:null,crop:null,zoom:null},v.setDefaults=function(i){t.extend(v.DEFAULTS,i)},v.TEMPLATE='<div class="cropper-container"><div class="cropper-wrap-box"><div class="cropper-canvas"></div></div><div class="cropper-drag-box"></div><div class="cropper-crop-box"><span class="cropper-view-box"></span><span class="cropper-dashed dashed-h"></span><span class="cropper-dashed dashed-v"></span><span class="cropper-center"></span><span class="cropper-face"></span><span class="cropper-line line-e" data-action="e"></span><span class="cropper-line line-n" data-action="n"></span><span class="cropper-line line-w" data-action="w"></span><span class="cropper-line line-s" data-action="s"></span><span class="cropper-point point-e" data-action="e"></span><span class="cropper-point point-n" data-action="n"></span><span class="cropper-point point-w" data-action="w"></span><span class="cropper-point point-s" data-action="s"></span><span class="cropper-point point-ne" data-action="ne"></span><span class="cropper-point point-nw" data-action="nw"></span><span class="cropper-point point-sw" data-action="sw"></span><span class="cropper-point point-se" data-action="se"></span></div></div>',v.other=t.fn.cropper,t.fn.cropper=function(i){var s,n=a(arguments,1);return this.each(function(){var e,a,r=t(this),o=r.data(M);if(!o){if(/destroy/.test(i))return;e=t.extend({},r.data(),t.isPlainObject(i)&&i),r.data(M,o=new v(this,e))}"string"==typeof i&&t.isFunction(a=o[i])&&(s=a.apply(o,n))}),e(s)?this:s},t.fn.cropper.Constructor=v,t.fn.cropper.setDefaults=v.setDefaults,t.fn.cropper.noConflict=function(){return t.fn.cropper=v.other,this}}),function(t){"use strict";var i=t.HTMLCanvasElement&&t.HTMLCanvasElement.prototype,e=t.Blob&&function(){try{return Boolean(new Blob)}catch(t){return!1}}(),a=e&&t.Uint8Array&&function(){try{return 100===new Blob([new Uint8Array(100)]).size}catch(t){return!1}}(),s=t.BlobBuilder||t.WebKitBlobBuilder||t.MozBlobBuilder||t.MSBlobBuilder,n=/^data:((.*?)(;charset=.*?)?)(;base64)?,/,r=(e||s)&&t.atob&&t.ArrayBuffer&&t.Uint8Array&&function(t){var i,r,o,h,c,l,p,d,u;if(i=t.match(n),!i)throw new Error("invalid data URI");for(r=i[2]?i[1]:"text/plain"+(i[3]||";charset=US-ASCII"),o=!!i[4],h=t.slice(i[0].length),c=o?atob(h):decodeURIComponent(h),l=new ArrayBuffer(c.length),p=new Uint8Array(l),d=0;d<c.length;d+=1)p[d]=c.charCodeAt(d);return e?new Blob([a?p:l],{type:r}):(u=new s,u.append(l),u.getBlob(r))};t.HTMLCanvasElement&&!i.toBlob&&(i.mozGetAsFile?i.toBlob=function(t,e,a){t(a&&i.toDataURL&&r?r(this.toDataURL(e,a)):this.mozGetAsFile("blob",e))}:i.toDataURL&&r&&(i.toBlob=function(t,i,e){t(r(this.toDataURL(i,e)))})),"function"==typeof define&&define.amd?define(function(){return r}):"object"==typeof module&&module.exports?module.exports=r:t.dataURLtoBlob=r}(window);